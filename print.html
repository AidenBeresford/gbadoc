<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>gbadoc</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documents the workings of the Game Boy Advance hardware">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Intro</a></li><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="graphics.html"><strong aria-hidden="true">2.</strong> Graphics Hardware</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">gbadoc</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This is a community effort to provide an open document about the Game Boy Advance (GBA).</p>
<p>The book is provided to you under the <a href="https://creativecommons.org/publicdomain/zero/1.0/legalcode">Creative Commons 0 License</a>.</p>
<p>If you'd like to ask questions, report problems, or contribute, then go to our <a href="https://github.com/gbdev/gbadoc">GitHub Repository</a>.</p>
<p>If you want to just chat about GBA topics you can join the <a href="https://discord.io/gbadev">GBADev Discord</a>.</p>
<h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<ul>
<li><strong>CPU:</strong> An <a href="https://en.wikipedia.org/wiki/ARM7#ARM7TDMI">ARM7TDMI</a> core running
at 16.78 MHz. No floating point unit.</li>
<li><strong>Screen:</strong> A 2.9 inch LCD screen with a 240 by 160 resolution.</li>
<li><strong>Video:</strong> Runs at approximately 59.72 Hz. Supports tiled graphics in &quot;text&quot; or
&quot;affine&quot; modes, as well as bitmap graphics. 5-bit per channel RGB color.</li>
<li><strong>Audio:</strong> Supports 8-bit wave output as well as the legacy Procedural Sound
Generator (PSG) chips from the Game Boy.</li>
<li><strong>Input:</strong> Directional pad (up, down, left, right, plus diagonals), four primary
buttons (A, B, L, R), two secondary buttons (Start, Select).</li>
<li><strong>Memory:</strong>
<ul>
<li>32k of CPU internal RAM (a small portion of this is pre-allocated)</li>
<li>256k of CPU external RAM (totally free for any use)</li>
<li>96k of Video RAM (the structure here depends on the video mode)</li>
<li>128 Object entries, used to display &quot;sprites&quot;.</li>
<li>32 Affine parameter entries.</li>
<li>256 palette entries for Backgrounds (&quot;backdrop&quot; plus 255 usable colors).</li>
<li>256 palette entries for Objects (of which 255 are usable).</li>
<li>Supports ROMs of up to 32MB in size.</li>
</ul>
</li>
<li><strong>Other Peripherals:</strong>
<ul>
<li>Serial port that supports up to four devices in the network.</li>
<li>Four Direct Memory Access (DMA) units. These perform faster memory copies
than the CPU can, and they can be set to automatically activate at
particular times, but the CPU is paused when they are active.</li>
<li>Four timer units.</li>
</ul>
</li>
</ul>
<p>Programs run on the GBA are usually contained in a &quot;Game Pak&quot;. A &quot;Game Pak&quot; consists mainly of ROM and possibly Cart RAM (in the form of SRAM, Flash ROM, or EEPROM, used mainly for save game info). The ROM is where compiled code and data is stored. Unlike home computers, workstations, or servers, there are no disks or other drives, so everything that might otherwise have been stored as separate resource files must be compiled into the program ROM itself. Luckily there are tools to aid in this process.</p>
<p>The primary means a program accesses specialized hardware for graphics, sound, and other IO is through the memory-mapped IO. Memory mapped IO is a means of communicating with hardware by writing to/reading from specific memory addresses that are &quot;mapped&quot; to internal hardware functions. For example, you might write to address 0x4000000 with the value &quot;0x0100&quot;, which tells the hardware &quot;enable background 0 and graphics mode 0&quot;. A secondary means is through the BIOS, which is embedded in the internal GBA system ROM. Using software interrupts it is possible to access pre-programmed (and hopefully optimized) routines lying in the the system ROM. These routines then access the hardware through the memory-mapped IO.</p>
<p>Other regions of memory that are directly mapped to the hardware are Palette RAM (which is a table consisting of all the available colors), VRAM (which performs a similar function to the video RAM on a PC - and thensome), and OAM (which contains the attributes for hardware accelerated sprites). </p>
<h2 id="memory-map"><a class="header" href="#memory-map">Memory Map</a></h2>
<p>The following are the general areas of memory as seen by the CPU, and what they are used for.</p>
<h3 id="system-rom-bios"><a class="header" href="#system-rom-bios">System ROM (BIOS)</a></h3>
<ul>
<li>Start: 0x00000000</li>
<li>End:  0x0003FFF</li>
<li>Size: 16kb </li>
<li>Port Size: 32 bit</li>
<li>Wait State: 0</li>
</ul>
<p>0x0 - 0x00003FFF contain the BIOS, which is executable but not readable. Any attempt to read in the area from 0x0 to 0x1FFFFFFF will result in failure; what you will see on a read is the current prefetched instruction (the instruction after the instruction used to view the memory area), thus giving the appearance that this area of memory consists of a repeating byte pattern.</p>
<h3 id="external-work-ram-ewram"><a class="header" href="#external-work-ram-ewram">External Work RAM (EWRAM)</a></h3>
<ul>
<li>Start: 0x02000000</li>
<li>End:   0x0203FFFF</li>
<li>Size:  256kb</li>
<li>Port Size: 16 bit</li>
<li>Mirrors:  Every 0x40000 bytes from 0x02000000 to 0x02FFFFFF</li>
</ul>
<p>This space is available for your game's data and code. If a multiboot cable is present on startup, the BIOS automatically detects it and downloads binary code from the cable and places it in this area, and execution begins with the instruction at address 0x02000000 (the default is 0x08000000). Though this is the largest area of RAM available on the GBA, memory transfers to and from EWRAM are 16 bits wide and thus consume more cycles than necessary for 32 bit accesses. Thus it is advised that 32 bit ARM code be placed in IWRAM rather than EWRAM.</p>
<h3 id="internal-work-ram-iwram"><a class="header" href="#internal-work-ram-iwram">Internal Work RAM (IWRAM)</a></h3>
<ul>
<li>Start: 0x03000000</li>
<li>End:   0x03007FFF</li>
<li>Size:  32kb</li>
<li>Port Size: 32 bit</li>
<li>Mirrors:  Every 0x8000 bytes from 0x03000000 to 0x03FFFFFF</li>
</ul>
<p>This space is also available for use. It is the fastest of all the GBA's RAM, being internally embedded in the ARM7 CPU chip package and having a 32 bit bus. As the bus for ROM and EWRAM is only 16 bits wide, the greatest efficiency will be gained by placing 32 bit ARM code in IWRAM while leaving thumb code for EWRAM or ROM memory.</p>
<h3 id="io-ram"><a class="header" href="#io-ram">IO Ram</a></h3>
<ul>
<li>Start: 0x04000000</li>
<li>End:   0x040003FF (0x04010000)</li>
<li>Size:  1Kb</li>
<li>Port Size:  Dual ported 32 bit</li>
<li>Mirrors:  The word at 0x04000800 (only!) is mirrored every 0x10000 bytes
from 0x04000000 - 0x04FFFFFF.</li>
</ul>
<p>This area contains a mirror of the ASIC (Application Specific Integrated Circuit) registers on the GBA. This area of memory is used to control the graphics, sound, DMA, and other features. See memory-mapped IO registers for details on the function of each register.</p>
<h3 id="palette-ram-palram"><a class="header" href="#palette-ram-palram">Palette RAM (PALRAM)</a></h3>
<ul>
<li>Start: 0x05000000</li>
<li>End:   0x050003FF</li>
<li>Size:  1kb</li>
<li>Port Size:  16 bit</li>
<li>Mirrors: Every 0x400 bytes from 0x05000000 to 0x5FFFFFF</li>
</ul>
<p>This area specifies the 16-bit color values for the paletted modes. There are two areas of the palette: one for backgrounds (0x05000000) and another for sprites (0x05000200). Each of these is either indexed as a single, 256-color palette, or as 16 individual 16-color palettes, depending on the settings of a particular sprite or background.</p>
<h3 id="video-ram-vram"><a class="header" href="#video-ram-vram">Video RAM (VRAM)</a></h3>
<ul>
<li>Start: 0x06000000</li>
<li>End:   0x06017FFF</li>
<li>Size:  96kb</li>
<li>Port Size: 16 bit</li>
<li>Mirrors: Bytes 0x06010000 - 0x06017FFF is mirrored from 0x06018000 - 0x0601FFFF.
The entire region from 0x06000000 - 0x06020000 is in turn mirrored every
0x20000 bytes from 0x06000000 - 0x06FFFFFF.</li>
</ul>
<p>The video RAM is used to store the frame buffer in bitmapped modes, and the tile data and tile maps for tile-based &quot;text&quot; and rotate/scale modes.</p>
<h3 id="obj-attribute-memory-oam"><a class="header" href="#obj-attribute-memory-oam">OBJ Attribute Memory (OAM)</a></h3>
<ul>
<li>Start: 0x07000000</li>
<li>End:   0x070003FF</li>
<li>Size:  1kb</li>
<li>Port Size: 32 bit</li>
<li>Mirrors: Every 0x400 bytes from 0x07000000 to 0x07FFFFFF</li>
</ul>
<p>This is the Object Attribute Memory, and is used to control the GBA's sprites.</p>
<p>The following areas of memory are technically cart-dependent, but can generally be expected to behave as described.</p>
<h3 id="game-pak-image-0-rom"><a class="header" href="#game-pak-image-0-rom">Game Pak, Image 0 (ROM)</a></h3>
<ul>
<li>Start: 0x08000000</li>
<li>Size:  The size of the cartridge (0 - 32 megabytes) </li>
<li>Port Size: 16 bit</li>
<li>Wait State: 0</li>
</ul>
<p>The ROM in the game cartridge appears in this area. If a cartridge is present on startup, the instruction found at location 0x08000000 is loaded into the program counter and execution begins from there. Note that the transfers to and from ROM are all 16 bits wide.</p>
<h3 id="game-pak-image-1-rom"><a class="header" href="#game-pak-image-1-rom">Game Pak, Image 1 (ROM)</a></h3>
<ul>
<li>Start: 0x0A000000</li>
<li>Size:  The size of the cartridge (0 - 32 megabytes)</li>
<li>Port Size:  16 bit</li>
<li>Wait State: 1</li>
</ul>
<p>This is a mirror of the ROM above. Used to allow multiple speed ROMs in a single game pak.</p>
<h3 id="game-pak-image-2-rom"><a class="header" href="#game-pak-image-2-rom">Game Pak, Image 2 (ROM)</a></h3>
<ul>
<li>Start: 0x0C000000</li>
<li>Size:  The size of the cartridge (0 - 32 megabytes)</li>
<li>Port Size: 16 bit</li>
<li>Wait State: 2</li>
</ul>
<p>This is a mirror of the ROM above. Used to allow multiple speed ROMs in a single game pak.</p>
<h3 id="game-pak-ram"><a class="header" href="#game-pak-ram">Game Pak RAM</a></h3>
<ul>
<li>Start: 0x0E000000 (also seem to appear at 0x0F000000)</li>
<li>Size:  0 - 64 kb</li>
<li>Port Size: 8 bit</li>
</ul>
<p>This is either SRAM or Flash ROM. Used primarily for saving game data. SRAM can be up to 64kb but is usually 32 kb. It has a battery backup so has the longest life (in terms of how many times it can be written to) of all backup methods. Flash ROM is usually 64 kb. Its lifespan is determined by the number of rewrites that can be done per sector (a 10,000 rewrite minimum is cited by some manufacturers).</p>
<h3 id="eeprom"><a class="header" href="#eeprom">EEPROM</a></h3>
<p>This is another kind of cart memory, but operates differently from SRAM or Flash ROM. Unfortunately, I don't know the details of how it can be accessed by the programmer (mail me if you have more information on it). It uses a serial connection to transmit data. The maximum size is 128 mb, but it can be any size, and is usually 4 kb or 64 kb. Like Flash ROM it has a limited life; some manufacturers cite a minimum of 100,000 rewrites per sector.</p>
<p>There may be other regions of memory known as DEBUG ROM 1 and DEBUG ROM 2, though I really don't know whether these are a part of commercial carts or if they are mapped to some part of the internal ROM, or if they're even available on a standard GBA.</p>
<p>Note that EWRAM, IWRAM, VRAM, OAM, Palette RAM are all initialized to zero by the BIOS (i.e. you can expect them to be zeroed at startup). </p>
<h1 id="graphics-hardware-overview"><a class="header" href="#graphics-hardware-overview">Graphics Hardware Overview</a></h1>
<p>The GBA has a TFT color LCD that is 240 x 160 pixels in size and has a refresh rate of exactly 280,896 cpu cycles per frame, or around 59.73 hz. Most GBA programs will need to structure themselves around this refresh rate. Each refresh consists of a 160 scanline vertical draw (VDraw) period followed by a 68 scanline blank (VBlank) period. Furthermore, each of these scanlines consists of a 1004 cycle draw period (HDraw) followed by a 228 cycle blank period (HBlank). During the HDraw and VDraw periods the graphics hardware processes background and obj (sprite) data and draws it on the screen, while the HBlank and VBlank periods are left open so that program code can modify background and obj data without risk of creating graphical artifacts.
Video Modes</p>
<p>Exactly what the GBA draws on screen depends largely on the current video mode (also sometimes referred to as the screen mode or graphics mode). The GBA has 6 such modes, some of which are bitmap-based and some of which are tile-based. The video mode is set by the bottom three bits of the hardware register known as REG_DISPCNT. Background data is handled differently depending on what mode is enabled. Backgrounds can either be text backgrounds (tile based), rotate-scale backgrounds (tile based backgrounds that can be transformed), or bitmap backgrounds. The starting address and size sprite graphics memory is also dependent on video mode. It starts at 0x6010000 for tile modes and 0x6014000 for bitmapped modes.</p>
<p>Enabling objs and one or more backgrounds in REG_DISPCNT will cause the GBA to draw the specified backgrounds and objs in order of priority.</p>
<h3 id="mode-0"><a class="header" href="#mode-0">Mode 0</a></h3>
<p>In this mode, four text background layers can be shown. In this mode backgrounds 0 - 3 all count as &quot;text&quot; backgrounds, and cannot be scaled or rotated. Check out the section on text backgrounds for details on this.</p>
<h3 id="mode-1"><a class="header" href="#mode-1">Mode 1</a></h3>
<p>This mode is similar in most respects to Mode 0, the main difference being that only 3 backgrounds are accessible -- 0, 1, and 2. Bgs 0 and 1 are text backgrounds, while bg 2 is a rotation/scaling background.</p>
<h3 id="mode-2"><a class="header" href="#mode-2">Mode 2</a></h3>
<p>Like modes 0 and 1, this uses tiled backgrounds. It uses backgrounds 2 and 3, both of which are rotate/scale backgrounds.</p>
<h3 id="mode-3"><a class="header" href="#mode-3">Mode 3</a></h3>
<p>Standard 16-bit bitmapped (non-paletted) 240x160 mode. The map starts at 0x06000000 and is 0x12C00 bytes long. See the Color Format table above for the format of these bytes.</p>
<p>This allows the full color range to be displayed at once. Unfortunately, the frame buffer in this mode is too large for page flipping to be possible. One option to get around this would be to copy a frame buffer from work RAM into VRAM during the retrace, or (so I have heard) to use DMA3 with the start mode bits set to 11.</p>
<h3 id="mode-4"><a class="header" href="#mode-4">Mode 4</a></h3>
<p>8-Bit paletted bitmapped mode at 240x160. The bitmap starts at either 0x06000000 or 0x0600A000, depending on bit 4 of REG_DISPCNT. Swapping the map and drawing in the one that isn't displayed allows for page flipping techniques to be used. The palette is at 0x5000000, and contains 256 16-bit color entries.</p>
<h3 id="mode-5"><a class="header" href="#mode-5">Mode 5</a></h3>
<p>This is another 16-bit bitmapped mode, but at a smaller resolution of 160x128. The display starts at the upper left hand corner of the screen, but can be shifted using the rotation and scaling registers for BG2. The advantage of using this mode is presumably that there are two frame buffers available, and this can be used to perform page flipping effects which cannot be done in mode 3 due to the smaller memory requirements of mode 5. Bit 4 of REG_DISPCNT sets the start of the frame buffer to 0x06000000 when bit 4 is zero, and 0x600A000 when bit 4 is one. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
